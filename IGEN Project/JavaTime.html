<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glove Receiver</title>
</head>
<script src="./Tone.js"></script>

<style>
    body{
        background-image: url(./zAssets/wood.jpeg);
    }
    span.main{
        position: absolute;
        background-image: url(./zAssets/blackground.jpg);
        background-clip: padding-box;
        border: 16px solid #313537;
        border-radius: 36px;
        border-bottom-right-radius: 80px;
        background-color: white;
        left: 0px;
        right: 0px;
        top: 0px;
        bottom: 0px;
        width: 90%;
        height: 80%;
        margin: auto;
        overflow: hidden !important;
        font-family: comic sans MS;
    }
    span.settings{
        position: absolute;
        background-color: transparent;
        width: 20%;
        height: 6%;
        right: 5%;
    }
    div.button1{
        position: absolute;
        background-color:rgba(245, 245, 245, 0.25);
        width: 60%;
        height: 12%;
        left: 2%;
        bottom: 65%;
    }
    div.button2{
        position: absolute;
        background-color:rgba(245, 245, 245, 0.25);
        width: 20%;
        height: 12%;
        left: 5%;
        bottom: 50%;
        opacity: 50%;
    }
    div.button3{
        position: absolute;
        background-color:rgba(245, 245, 245, 0.25);
        width: 30%;
        height: 12%;
        left: 30%;
        bottom: 50%;
        opacity: 50%;
    }
    div.flex1{
        position: inherit;
        background-image: url(./zAssets/wood2.jpeg);
        background-color: pink;
        border-bottom: 10px solid #313537;
        width: 33.33%;
        height: 18%;
        top: 0px;
        left: 0%;
    }
    div.flex2{
        position: inherit;
        background-image: url(./zAssets/wood2.jpeg);
        background-color: hotpink;
        border-bottom: 10px solid #313537;
        width: 33.33%;
        height: 18%;
        top: 0px;
        left: 33.33%;
    }
    div.flex3{
        position: inherit;
        background-image: url(./zAssets/wood2.jpeg);
        background-color: fuchsia;
        border-bottom: 10px solid #313537;
        width: 33.33%;
        height: 18%;
        top: 0px;
        left: 66.66%;
    }
    div.flexBarOut{
        position: inherit;
        border: 8px solid black;
        border-radius: 20px;
        background-color: #9C9C9C;
        width: 60%;
        height: 40%;
        left: 10px;
        bottom: 10px;
        overflow: hidden;
    }
    div.flexBarIn{
        background-color: #0AA30C;
        height: 100%;
        width: 1%;
        top: 0px;
        transition-property: background-color;
        transition-duration: 0.4s;
    }
    div.flexNum{
        position: inherit;
        background-color: white;
        border: 5px solid black;
        width: 20%;
        height: 40%;
        right: 5%;
        bottom: 10%;
        font-weight: bold;
        font-size: 24px;
        text-align: center;
        align-items: center;
    }
    input.slider1{
        position: absolute;
        width: 20%;
        height: 10%;
        top: 120px;
        right: 5%;
    }
    input.slider2{
        position: absolute;
        width: 20%;
        height: 10%;
        top: 160px;
        right: 5%;
        
    }
    input.slider3{
        position: absolute;
        width: 20%;
        height: 10%;
        top: 200px;
        right: 5%;
    }
    text.flexLabel{
        position: inherit;
        left: 0px;
        right: 0px;
        margin: auto;
        top: 5px;
        text-align: center;
        font-weight: bold;
        font-size: 24px;;
        text-shadow: 1px 0 black;
    }
    button.notePress{
        position: inherit;
        background-image: url(./zAssets/metal.jpeg);
        border: 5px solid #414647;
        border-radius: 40px;
        width: 80px;
        height: 80px;
        right: 5%;
        bottom: 5%;
        font-size: 10px;
        font-weight: bold;
        font-family: comic sans MS;
        box-shadow: none;
        outline: none;
    }
    button.notePress:active{
        border-color: #585d5e;
        box-shadow: none;
        outline: none;
    }
    img.gear{
        position: absolute;
        height: 90%;
        right: 5px
    }
    img.links{
        position: absolute;
        height: 85%;
        right: 60px;
    }
    div.settings{
        position: inherit;
        border: 8px solid #696969;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
        background-color: white;
        padding: 10px;
        width: 150px;
        height: 300px;
        right: 5%;
        top: 100%;
        z-index: 1;
        display: none;
        font-size: 16px;
        font-weight: bold;
        font-family: comic sans MS;
        overflow: hidden;
        word-wrap: break-word;
    }
    div.references{
        position: absolute;
        border: 16px solid #696969;
        border-radius: 36px;
        border-bottom-right-radius: 80px;
        background-color: white;
        left: 0px;
        right: 0px;
        top: 0px;
        bottom: 0px;
        width: 90%;
        height: 80%;
        z-index: 1;
        margin: auto;
        overflow: hidden !important;
        font-family: comic sans MS;
        display: none;
    }
    div.play{
        position: absolute;
        border: 10px solid black;
        border-radius: 16px;
        background-color: grey;
        width: 30px;
        height: 30px;
        left: 120px;
        top: 5px;
        margin: 0;
    }
    text.play{
        position: absolute;
        background: rgba(245,245,245, 0.2);
        width: 100px;
        left: 15px;
        top: 10px;
        font-size: 42px;
        font-weight: bold;
        font-family: comic sans MS;
        text-align: center;
        text-shadow: royalblue;
        color:black;
    }
    div.stop{
        position: absolute;
        border: 10px solid black;
        border-radius: 16px;
        background-color: grey;
        width: 30px;
        height: 30px;
        left: 300px;
        top: 5px;
        margin: 0;
    }
    text.stop{
        position: absolute;
        background: rgba(245,245,245, 0.2);
        width: 100px;
        left: 190px;
        top: 10px;
        font-size: 42px;
        font-weight: bold;
        font-family: comic sans MS;
        text-align: center;
        text-shadow: royalblue;
        color:black;
    }
    input.fieldInput{
        width: 40px;
    }
</style>

<script>
//Import Dependencies
    const SerialPort = require("serialport");
    const Readline = require("@serialport/parser-readline");

    //Define Serial port
        const port = new SerialPort("COM1", {baudRate: 115200,});
    //Serial Port Parser
        const parser = new Readline();
        port.pipe(parser);

    //Read Serial Port data
        parser.on("data", (line));
        console.log(line);

        var references = str.split(" ");
        console.log(references);

//Create variables
    var accel        = references[0];
    var rotate       = references[1];
    var pointerFlex  = references[2];
    var middleFlex   = references[3];
    var thumbFlex    = references[4];
    var buttonOne    = references[5];
    var buttonTwo    = references[6];
    var buttonThree  = references[7];

    //Declaring aspect variables
    var volume;
    var maxVol;
    var minVol;
    var hertz;
    var maxHertz;
    var minHertz;
    var looper ;
    var play;

    var osc;

    // mute the output
    var firstTime;
    var hertzTest;
    var setValMax;

    var showing;

//Functions
    //loadMe Loads and initializes all variables
    function loadMe(){
        showingSet = false;
        showingRef = false;
        volume = -15;
        maxVol = 20;
        minVol = -15;
        hertz = 0;
        maxHertz = 1000;
        minHertz = 0;
        play = false;
        hertzTest = 0;
        setValMax = 100;
        //Initialize new oscillator, done once
            osc = new Tone.Oscillator(0).toDestination();
            osc.volume.value = -15;
    }


    //openSettings() Opens up the setting menu
    function openSettings(){
        document.getElementById("references").style.display = "none";
        if (showingSet == false){
            document.getElementById("settings").style.display = "block";
            showingSet = true;
        }
        else if (showingSet == true){
            document.getElementById("settings").style.display = "none";
            showingSet = false;
        }
    }
    //openRefs() Opens up additional references menu
    function openRefs(){
        document.getElementById("settings").style.display = "none";
        if (showingRef == false){
            document.getElementById("references").style.display = "block";
            showingRef = true;
        }
        else if (showingRef == true){
            document.getElementById("references").style.display = "none";
            showingRef = false;
        }
    }


    //setFlex(Finger, Value) Takes in variable value and displays numerically/using bar
    //Finger: The finger which is affecting the bar
    //Value: The variable input created by the flex sensors
    function setFlex(finger, value){
        var setVal = value;

        if (finger == pointer){
            //Adjusts raw volume and set as the actual volume
                volume = ( (minVol) + ( (maxVol-minVol)*(setVal/100) ) );
                volume = volume.toFixed(1);
                osc.volume.value = volume;
            //Update the UI
            document.getElementById("pointerBar").style.width = setVal + "%";
            document.getElementById("flexNum1").innerHTML = volume + "db";
            if (setVal < 30){
                document.getElementById("pointerBar").style.backgroundColor = '#0AA30C';
            }
            else if (setVal > 40 && setVal < 90){
                document.getElementById("pointerBar").style.backgroundColor = '#D0D40F';
            }
            else if (setVal > 90){
                document.getElementById("pointerBar").style.backgroundColor = '#E12120';
            }
        }
        if (finger == middle){
            //Adjusts Hz of the output oscillator
                //Declare min/max in hertz
                hertzTest = ((12)*(setVal/setValMax))+28;
                hertz = (2**((hertzTest.toFixed(0)-49)/12))*440
                hertz = hertz.toFixed(2);
                osc.frequency.value = hertz;
            //Update the UI
            document.getElementById("middleBar").style.width = setVal + "%";
            document.getElementById("flexNum2").innerHTML = hertz + "hz";
            if (setVal < 30){
                document.getElementById("middleBar").style.backgroundColor = '#0AA30C';
            }
            else if (setVal > 40 && setVal < 90){
                document.getElementById("middleBar").style.backgroundColor = '#D0D40F';
            }
            else if (setVal > 90){
                document.getElementById("middleBar").style.backgroundColor = '#E12120';
            }

        }
        if (finger == thumb){
            document.getElementById("thumbBar").style.width = setVal + "%";
            document.getElementById("flexNum3").innerHTML = setVal + "%";
            if (setVal < 30){
                document.getElementById("thumbBar").style.backgroundColor = '#0AA30C';
            }
            else if (setVal > 40 && setVal < 90){
                document.getElementById("thumbBar").style.backgroundColor = '#D0D40F';
            }
            else if (setVal > 90){
                document.getElementById("thumbBar").style.backgroundColor = '#E12120';
            }
        }

        //Clear and display updated values to console
        console.clear();
        console.log("Volume set to: " + volume + "db");
        console.log("Pitch set to: " + hertz + "hz");
    }
    
    //playNote Initializes the oscillator, acts as the start/stop button
    function playNote(){
        //If oscillator is off, start it
        if (play == false){
            play = true;
            osc.start();
            document.getElementById("play").style.backgroundColor = "red";
            document.getElementById("stop").style.backgroundColor = "grey";
        }
        //If oscillator is playing, stop it
        else if (play == true){
            play = false;
            osc.stop();
            document.getElementById("play").style.backgroundColor = "grey";
            document.getElementById("stop").style.backgroundColor = "red";
        }
    }

</script>
<body onload="loadMe()">
    <span class="settings">
        <img class="gear" src="./zAssets/settings.png" onclick="openSettings()">
        <img class="links" src="./zAssets/daDrip.png" onclick="openRefs()">
        <div class="settings" id="settings">
            <center>Change Volume</center><br>
            Max
                <input type="text" class="fieldInput" id="newMaxVol" onchange="setMaxVol()"> db<br>
            Min
                <input type="text" class="fieldInput" id="newMinVol" onchange="setMinVol()"> db<br>
            GetOuttaMyHeadGetOuttaMyHeadGetOuttaMyHeadGetOuttaMyHeadGetOuttaMyHeadGetOuttaMyHeadGetOuttaMyHeadGetOuttaMyHeadGetOuttaMyHeadGetOuttaMyHeadGetOuttaMyHeadGetOuttaMyHeadGetOuttaMyHeadGetOuttaMyHead
        </div>
    </span>
    <div class="references" id="references">
        Oh what how, alexa play sanctuary guardian
    </div>
    <span class="main">
        <div class="flex1">
            <text class="flexLabel">Pointer</text>
            <div class="flexBarOut">
                <div class="flexBarIn" id="pointerBar"></div>
            </div>
            <div class="flexNum" id="flexNum1">uwu</div>
        </div>
            
        <div class="flex2">
            <text class="flexLabel">Middle</text>
            <div class="flexBarOut">
                <div class="flexBarIn" id="middleBar"></div>
            </div>
            <div class="flexNum" id="flexNum2">o_O</div>
        </div>
            
        <div class="flex3">
            <text class="flexLabel">ThumbyThicc</text>
            <div class="flexBarOut">
                <div class="flexBarIn" id="thumbBar"></div>
            </div>
            <div class="flexNum" id="flexNum3">OwO</div>
        </div>
        
        <div class="buttons">
            <!--Interface for play/pause/stop-->
            <div class="button1">
                <div class="play" id="play"></div>
                    <text class="play">Play</text>
                <div class="stop" id="stop"></div>
                    <text class="stop">Stop</text>
            </div>

            <!--Interface for start/stop record-->>
            <div class="button2"></div>

            <!--Interface for current mode toggle-->>
            <div class="button3"></div>
        </div>


            <!--Inputs to simulate flex sensors, remove later?-->
            <input type="range" class="slider1" id="pointer" min="1" max="100" value="1" step="1" oninput="setFlex(pointer, value)">
            <input type="range" class="slider2" id="middle" min="1" max="100" value="1" step="1" oninput="setFlex(middle, value)">
            <input type="range" class="slider3" id="thumb" min="1" max="100" value="1" step="1" oninput="setFlex(thumb, value)">

            <!--Button to activate oscillator-->
                <button class="notePress" onclick="playNote()">cAn YoU hElP mE</button>
    </span>
</body>
</html>
https://tonejs.github.io/
https://www.guitarland.com/MusicTheoryWithToneJS/PlayNote.html
http://sites.music.columbia.edu/cmc/courses/g6611/spring2018/week3/index.html
https://github.com/Team-06-Haptic-Glove/MIDI-Controller

